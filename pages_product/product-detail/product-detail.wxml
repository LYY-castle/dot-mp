<!-- pages/product/product-detail/product-detail.wxml -->
<view class="container">
  <v-navigator page-name="你当前页面的名字"></v-navigator>
  <view wx:if="{{showContent}}" class="swiperContent">
    <swiper indicator-dots="{{indicatorDots}}" class="my-swipe" autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}">
      <block wx:for="{{goodsGalleries}}" wx:key="imgIndex">
        <swiper-item>
          <van-image src="{{item}}" height="100%" fit="heightFix" wx:if="{{item}}"></van-image>
          <van-image alt height="100%" fit="heightFix" wx:else use-loading-slot />
        </swiper-item>
      </block>
    </swiper>
    <view class="bg-color-white p-10 m-t-10">
      <view class="flex-start">
        <view class="minPrice fz-12" >
          <view wx:if="{{!isGroupPurchase}}">
            ￥
          <text class="fz-20 bold">{{goods.isPromote?goods.promotePrice:goods.retailPrice}}</text>
          <text wx:if="{{specificationResults.length>0}}">起</text>
          </view>
          <view wx:if="{{isGroupPurchase}}" >
            <view wx:for="{{campaignProductPriceRules}}" wx:key="ruleIndex" wx:for-index="ruleIndex" wx:if="{{ruleIndex===0}}">
              <text class="fz-16">{{item.minNum}}人团价</text>
              <text class="fz-18">￥</text>
              <text class="fz-30 bold">{{item.price}}</text>
            </view>
          </view>
        </view>
        <view class="originPrice" wx:if="{{goods.isPromote? goods.promotePrice < goods.marketPrice : goods.retailPrice < goods.marketPrice}}">￥{{goods.marketPrice}}</view>
      </view>
      <text class="fz-16 m-b-5" user-select="{{true}}" class="text-align-left flex-start">{{goods.name}}</text>
      <!-- <view class="flex-start fz-14" wx:if="{{goods.isRebate&&shoppingMoneyData}}">
      <van-icon name="{{rebateIcon}}" class="m-r-10"/>
      <text class="c-gray">自买或分享赚佣金</text>
      <text class="c-color-yellow bold">￥{{goods.rebateAmount}}</text>
    </view> -->
    </view>
    <view >
      <view class="bg-color-white p-10 m-t-10 flex-start-start fz-15" wx:if="{{campaignProductPriceRules}}">
        <view class="m-r-15">活动</view>
        <view>
          <view wx:for="{{campaignProductPriceRules}}" wx:key="ruleIndex" wx:for-index="ruleIndex" class="m-b-10 c-color-gray flex-start">
              <van-tag color="#ffe1e1" text-color="#ad0000">多拼优惠</van-tag>
              <text class="m-l-15">拼满</text>
              <text class="bold">{{item.minNum}}</text>
              <text>人，惊喜价</text>
              <text class="bold c-red">{{item.price}}</text>元
          </view>
        </view>
      </view>
      <view class="bg-color-white p-10 m-t-10" wx:if="{{teamStatistics}}">
        <view class="flex-between">
          <view wx:if="teamStatistics.clusteringNum>0">当前已成团人数:
          <text class="bold fz-16">{{teamStatistics?teamStatistics.clusteringNum:0}}</text>
        </view>
        <view class="c-gray flex-start">剩余
                      <van-count-down use-slot time="{{ activityTime }}" bind:change="timeChange">
                        <text class="item" wx:if="{{timeData.days}}">{{ timeData.days }}天</text>
                        <text class="item" wx:if="{{timeData.hours}}">{{ timeData.hours }}时</text>
                        <text class="item" wx:if="{{timeData.minutes}}">{{ timeData.minutes }}分</text>
                        <text class="item" >{{ timeData.seconds }}秒</text>
                      </van-count-down>
                    </view>
        </view>
        <view class="flex-between fz-16 m-t-15" wx:if="{{teams.length>0}}">
          <text class="c-color-gray">{{teamStatistics.noClusteringNum}}人正在拼团，可直接参与</text>
          <view bindtap="lookAllTeam" class="fz-14 c-gray" wx:if="{{teams.length>1}}">查看全部 <van-icon name="arrow" /></view>
        </view>
        <view class="teamsStyle" wx:if="{{teams.length>0}}">
          <swiper indicator-dots="{{false}}" class="my-swipe" autoplay="{{true}}" interval="{{interval}}" duration="{{duration}}" vertical="{{true}}">
            <block wx:for="{{teams}}" wx:key="teamIndex" wx:for-item="team">
              <swiper-item class="flex-between border-top">
                <view class="flex-start">
                  <view wx:for="{{team.users}}" wx:key="userIndex" wx:for-item="user" >
                    <van-image src="{{user.avatar}}" height="40px" width="40px" fit="cover" round="{{true}}" class="m-r-2" wx:if="{{user.avatar}}"></van-image>
                    <van-image src="{{defaultPerson}}" alt height="40px" width="40px" fit="cover" round="{{true}}" class="m-r-2" wx:else />
                  </view>
                  <van-image src="{{addPerson}}" alt height="40px" width="40px" fit="cover" round="{{true}}" class="m-r-2"  wx:for="{{team.clusteringUserNum-team.nowUserNum}}" wx:key="imgIdx"/>
                </view>
                <view class="flex-colum-between">
                  <view class="fz-12 text-align-right p-r-2">
                    <view>还差
                      <text class="c-red">{{team.clusteringUserNum-team.nowUserNum}}人</text>
                      拼成
                    </view>
                    <van-button type="danger" size="small" block round bind:click="joinTeam" data-team="{{team}}" wx:if="{{shareId?false:team.buttonShow}}" disabled="{{!addressSelectShow?goods.isOnSale===1&&goods.goodsNumber===0:jdSku.isPlaceAnOrder===0}}">去参团</van-button>
                  </view>
                </view>
              </swiper-item>
            </block>
          </swiper>
        </view>
      </view>
    </view>
     <view class="bg-color-white p-10 m-t-10" wx:if="{{addressSelectShow}}">
       <view class="flex-between" bindtap="openAddressPop">
        <view class="flex-start">
          <text class="fz-14 bold">送至</text>
          <van-icon name="location-o" class="m-l-10 m-r-5 fz-14" color="#ee0a24" />
          <view class="fz-14">
              <view wx:if="{{addressListData.length>0}}" >
                {{activeAddressItem.provinceName}}{{activeAddressItem.cityName}}{{activeAddressItem.districtName}}{{activeAddressItem.address}}
              </view>
              <view wx:if="{{addressListData.length===0}}">广东省深圳市南山区</view>
          </view>
        </view>
        <view class="bold fz-12">{{jdSku.stockStateDesc}}</view>
        <van-icon name="ellipsis" />
      </view>
     </view>
    <view wx:if="{{goodsAttributeResults && goodsAttributeResults.length > 0}}" class="bg-color-white m-t-10 p-10">
      <van-divider dashed="{{true}}" contentPosition="center">产品参数</van-divider>
      <view wx:for="{{goodsAttributeResults}}" wx:for-item="content" wx:key="index" class="fz-14 flex-start m-b-10">
        <view class="title">{{ content.name}}</view>
        <view class="description">{{ content.val }}</view>
      </view>
    </view>
    <view class="product">
      <view wx:if="{{goods.goodsDetail}}">
        <van-divider dashed="{{true}}" contentPosition="center">产品详情</van-divider>
        <rich-text nodes="{{goods.goodsDetail}}" class="produceDetail"></rich-text>
      </view>
      <van-empty description="暂无描述信息" wx:else />
    </view>
  </view>
  <address-list addressShow="{{addressShow}}" addressListData="{{addressListData}}" bind:selectAddressItem="selectAddressItem"></address-list>
  <specification perchaseShow="{{perchaseShow}}" activePic="{{activePic}}" activePrice="{{activePrice}}" activeProductNumber="{{activeProductNumber}}" goodsSpecificationNameValue="{{goodsSpecificationNameValue}}" specificationResults="{{specificationResults}}" number="{{number}}" goods="{{goods}}" products="{{products}}" operateType="{{operateType}}" bind:operate="operate"></specification>
  <van-goods-action wx:if="{{!isGroupPurchase}}">
    <van-goods-action-icon icon="wap-home-o" text="首页" url="/pages/index/index" link-type="switchTab" />
    <van-goods-action-icon icon="cart-o" text="购物车" info="{{cartDotsNum}}" url="/pages/shopping_cart/shopping-cart" link-type="switchTab" />
    <van-goods-action-button wx:if="{{!addressSelectShow?goods.goodsNumber>0&&goods.isOnSale:jdSku.isPlaceAnOrder}}" text="加入购物车" color="#ee0a24" bind:click="onClickButton" data-option="cart" />
    <van-goods-action-button wx:if="{{!addressSelectShow?goods.goodsNumber>0&&goods.isOnSale:jdSku.isPlaceAnOrder}}" color="#f9ae08" text="立即购买" bind:click="onClickButton" data-option="perchase" class="m-r-15"/>
    <van-goods-action-button class="m-r-15" color="#aaa" text="已售空" wx:if="{{!addressSelectShow?goods.isOnSale===1&&goods.goodsNumber===0:jdSku.isPlaceAnOrder===0}}"/>
    <van-goods-action-button class="m-r-15" color="#aaa" text="已下架" wx:if="{{goods.isOnSale===0}}"/>
  </van-goods-action>
  <van-goods-action wx:if="{{isGroupPurchase}}">
    <van-goods-action-icon icon="wap-home-o" text="首页" url="/pages/index/index" link-type="switchTab" />
      <view wx:for="{{campaignProductPriceRules}}" wx:key="ruleIndex" wx:for-index="ruleIndex" wx:if="{{ruleIndex===0}}" class="fz-16 c-red w-100 text-align-right">
        <text>{{item.minNum}}人团价</text>
        <text class="bold">￥{{item.price}}</text>
      </view>
    <van-goods-action-button wx:if="{{!addressSelectShow?goods.goodsNumber>0&&goods.isOnSale:jdSku.isPlaceAnOrder}}" color="#f9ae08" text="{{teamPurchaseBtnText}}" bindtap="onClickButton" data-option="perchase" class="m-r-15"/>
    <van-goods-action-button wx:if="{{!addressSelectShow?goods.isOnSale===1&&goods.goodsNumber===0:jdSku.isPlaceAnOrder===0}}" color="#aaa" text="已售空" class="m-r-15"/>
  </van-goods-action>
    <van-dialog
    use-slot
    title="授权"
    show="{{ authorization }}"
    show-cancel-button="{{false}}"
    confirm-button-open-type="getPhoneNumber"
    bind:close="onClose"
    bind:getphonenumber="getphonenumber"
  >
    <view class="p-20 text-align-center">金小点需要您授权手机号用于拼单返购物金</view>
  </van-dialog>
  <van-dialog
    use-slot
    title="正在拼单"
    show="{{ teamsShow }}"
    show-cancel-button="{{false}}"
    showConfirmButton="{{false}}"
  >
    <van-icon name="close" class="closeTeams fz-20" bindtap="closeTeams"/>
    <view class="teamsPop">
      <view class="c-gray flex-center">剩余
        <van-count-down use-slot time="{{ activityTime }}" bind:change="timeChange" wx:if="{{activityTime}}">
                <text class="item" wx:if="{{timeData.days}}">{{ timeData.days }}天</text>
                <text class="item" wx:if="{{timeData.hours}}">{{ timeData.hours }}时</text>
                <text class="item" wx:if="{{timeData.minutes}}">{{ timeData.minutes }}分</text>
                <text class="item" >{{ timeData.seconds }}秒</text>
        </van-count-down>
        </view>
        <view class="flex-between border-top p-t-10" wx:for="{{teams}}" wx:key="teamIndex" wx:for-item="team">
        <view class="flex-start">
          <view wx:for="{{team.users}}" wx:key="userIndex" wx:for-item="user" >
            <van-image src="{{user.avatar}}" height="40px" width="40px" fit="cover" round="{{true}}" class="m-r-2" wx:if="{{user.avatar}}"></van-image>
            <van-image src="{{defaultPerson}}" alt height="40px" width="40px" fit="cover" round="{{true}}" class="m-r-2" wx:else />
          </view>
          <van-image src="{{addPerson}}" alt height="40px" width="40px" fit="cover" round="{{true}}" class="m-r-2"  wx:for="{{team.clusteringUserNum-team.nowUserNum}}" wx:key="imgIdx"/>
        </view>
        <view class="flex-colum-between">
          <view class="fz-12 text-align-right p-r-2">
            <view>还差
              <text class="c-red">{{team.clusteringUserNum-team.nowUserNum}}人</text>
              拼成
            </view>
            <van-button type="danger" size="small" round block bind:click="joinTeam" data-team="{{team}}" wx:if="{{shareId?false:team.buttonShow}}" disabled="{{!addressSelectShow?goods.isOnSale===1&&goods.goodsNumber===0:jdSku.isPlaceAnOrder===0}}">去参团</van-button>
          </view>
        </view>
      </view>
    </view>
  </van-dialog>
  <van-dialog id="van-dialog" />
  <!--  -->
  <van-dialog
    use-slot
    title="成团提醒"
    showConfirmButton="{{false}}"
    show="{{ authMsgShow }}"
  >
  <view>
    <view class="c-gray text-align-center p-10">为方便您及时获取拼团成功信息，请授权小程序提醒</view>
    <view class="flex-between">
      <van-button bindtap="getMessagesCancel" block disabled="{{!authMsgShow}}">取消</van-button>
      <van-button bindtap="getMessagesEnsure" block disabled="{{!authMsgShow}}">确定</van-button>
    </view>
  </view>
  </van-dialog>
</view>
